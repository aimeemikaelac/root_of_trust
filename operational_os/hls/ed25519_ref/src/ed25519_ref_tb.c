#include "fe25519.h"
#include "sc25519.h"
#include "ge25519.h"
#include "fixedint.h"
#include "sha512.h"
#include <string.h>
#include "stdio.h"


//int crypto_sign(
//    unsigned char sm[192],
//    const unsigned char m[128],
//    const unsigned char sk[64]
//    );

int crypto_sign(
		unsigned char mem[0x1000],
		unsigned int num_blocks,
		unsigned char sk[64],
		unsigned char signature_out[64]
		);


unsigned char signed_message[192] = {0};
unsigned char message[0x1000] = "test";
unsigned char pk[32] = {0x9d,0x7c,0xc8,0x34,0x8f,0x23,0x5c,0xb5,0x96,0xec,0xf1,0x1e,0x35,0xe2,0xd5,0x6f,0x99,0xdf,0xae,0x10,0x6a,0x47,0x8f,0x0f,0x4f,0xe6,0x2a,0x13,0x7c,0x06,0x07,0xdf};
unsigned char sk[64] = {0x7f,0x91,0x53,0x07,0xee,0x01,0xf3,0xfa,0x77,0xa4,0xff,0xb0,0xe8,0xf2,0x95,0x7b,0xe2,0x0d,0x46,0xea,0x5c,0x55,0x63,0x84,0x16,0xff,0x2e,0x26,0x52,0xc9,0x88,0xd1,
						0x9d,0x7c,0xc8,0x34,0x8f,0x23,0x5c,0xb5,0x96,0xec,0xf1,0x1e,0x35,0xe2,0xd5,0x6f,0x99,0xdf,0xae,0x10,0x6a,0x47,0x8f,0x0f,0x4f,0xe6,0x2a,0x13,0x7c,0x06,0x07,0xdf};

//unsigned char signature_ref[192] = {0x60,0xfc,0xb8,0x68,0xfb,0x3f,0x4d,0x29,0xbe,0x09,0x51,0xbf,0x17,0x4b,0x47,0xdd,0x8b,0x88,0x05,0x11,0x26,0xc9,0x99,0x43,0xda,0x0f,0x93,0x3e,0x07,0x49,0x3e,0x18,
//									0xd2,0xf3,0x06,0x8b,0x3b,0x1f,0x56,0x5d,0xde,0x04,0x01,0x78,0x8c,0xc4,0x9f,0x33,0x5f,0x21,0xe8,0xdb,0xbb,0xcf,0x77,0x15,0x44,0xa8,0xdc,0x17,0xe3,0x26,0x5e,0x0e,
//									0x74,0x65,0x73,0x74,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

unsigned char signature_ref[320] = {0x29,0x22,0x32,0xf9,0xdb,0xcb,0x52,0x0e,0xa2,0x6c,0xf8,0xfd,0x2c,0xaa,0xc5,0x42,0xb1,0x72,0x4e,0x55,0x1f,0x51,0xe3,0x95,0x6d,0x31,0x8a,0xc7,0x9b,0x19,0x66,0xf7,
									0xf0,0x93,0x1b,0x46,0x0a,0xbe,0x77,0xe9,0x99,0x05,0xcc,0x07,0x1f,0xc4,0xc5,0x9a,0xf5,0xe4,0xe6,0x89,0xcf,0x34,0x51,0x1d,0xee,0x50,0x97,0x9c,0xaf,0x7e,0x5e,0x09,
									0x74,0x65,0x73,0x74,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
									0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};


int main(){
	int i;
	unsigned long long ref_sm_len;
	unsigned char signature[64];

//	crypto_sign(signed_message, message, sk);
	crypto_sign(message, 2, sk, signature);


	printf("HLS sig:\n");
	for(i=0; i<64; i++){
//		if(i==32){
//			printf(" ");
//		}
//		if(i==64){
//			printf(" ");
//		}
		printf("%02x", signature[i]);
	}
	printf("\n");

	for(i=0; i<64; i++){
		if(signature_ref[i] != signature[i]){
			return -1;
		}
	}

	return 0;
}
